var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,o=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,n=(e,o,i)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(o){const i=new URL(t,location),n=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((o,s)=>{const r=new URL(t,i);if(self[e].moduleMap[r])return o(self[e].moduleMap[r]);const c=new Blob([`import * as m from '${r}';`,`${e}.moduleMap['${r}']=m;`],{type:"text/javascript"}),a=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){s(new Error(`Failed to import: ${t}`)),n(a)},onload(){o(self[e].moduleMap[r]),n(a)}});document.head.appendChild(a)})),self[e].moduleMap={}}}("/assets/");const s=Object.freeze({default:{category:"miscellaneous",squareSize:16,cost:{dirt:999},connections:[[0,-1],[1,0],[0,1],[-1,0]],lifeSupport:0,cargoSpace:0,drilling:0,powering:0,refining:0,printing:0,pulling:0,powerCapacity:1},"copper-hull":{cost:{"copper-parts":2},category:"hull"},"iron-hull":{cost:{"iron-beams":4},category:"hull"},"aluminum-hull":{cost:{"aluminum-plates":4},category:"hull"},"mini-dome":{squareSize:10,cost:{"aluminum-plates":5},connections:[[0,1]],lifeSupport:1},"survival-core":{category:"production",cost:{"enriched-uranium":5,"titanium-parts":10},cargoSpace:5,powering:1,refining:1,printing:1,pulling:1},"copper-structure-h":{category:"hull",cost:{"copper-parts":2}},"copper-structure-v":{category:"hull",cost:{"copper-parts":2}},"iron-structure-h":{cost:{"iron-beams":4},category:"hull"},"iron-structure-v":{cost:{"iron-beams":4},category:"hull"},"small-copper-drill":{category:"drills",squareSize:8,cost:{"copper-parts":10},connections:[[0,-1]],cargoSpace:1,drilling:1},"copper-drill":{category:"drills",cost:{"copper-parts":30},connections:[[0,-1]],cargoSpace:2,drilling:2},"iron-drill":{category:"drills",cost:{"iron-beams":30},connections:[[0,-1]],cargoSpace:3,drilling:3},"aluminum-drill":{category:"drills",cost:{"aluminum-plates":30,"iron-beams":1},connections:[[0,-1]],cargoSpace:5,drilling:4},"titanium-drill":{category:"drills",cost:{"titanium-parts":30},connections:[[0,-1]],cargoSpace:8,drilling:5},"obsidian-drill":{category:"drills",cost:{"obsidian-parts":30},connections:[[0,-1]],cargoSpace:10,drilling:6},"aluminum-cargo-drill":{category:"drills",squareSize:8,cost:{"aluminum-plates":10,"iron-beams":1},connections:[[0,-1]],cargoSpace:10,drilling:1},"copper-cargo":{category:"cargo",cost:{"copper-parts":30},cargoSpace:10,pulling:1},"aluminum-cargo":{category:"cargo",cost:{"aluminum-plates":30},cargoSpace:20,pulling:2},"titanium-cargo":{category:"cargo",cost:{"titanium-parts":30},cargoSpace:30,pulling:4},"obsidian-cargo":{category:"cargo",cost:{"obsidian-parts":30},cargoSpace:40,pulling:5},"copper-refinery":{category:"production",cost:{"copper-parts":40},cargoSpace:2,refining:1,pulling:1},"iron-refinery":{category:"production",cost:{"iron-beams":30},cargoSpace:3,refining:4,pulling:1},"titanium-refinery":{category:"production",cost:{"titanium-parts":40},cargoSpace:5,refining:5,pulling:2},"obsidian-refinery":{category:"production",cost:{"obsidian-parts":40},cargoSpace:6,refining:7,pulling:2},"copper-printer":{category:"production",cost:{"copper-parts":40},cargoSpace:2,printing:1,pulling:1},"aluminum-printer":{category:"production",cost:{"aluminum-plates":40},cargoSpace:4,printing:3,pulling:2},"titanium-printer":{category:"production",cost:{"titanium-parts":30},cargoSpace:6,printing:4,pulling:4},"obsidian-printer":{category:"production",cost:{"obsidian-parts":50},cargoSpace:7,printing:5,pulling:4},get(t){function e(t){return t?JSON.parse(JSON.stringify(t)):{}}return Object.assign({type:t},e(this.default),e(this[t]))},forEach(t){const e=["get","default","forEach"];Object.keys(this).filter((t=>!e.includes(t))).forEach((e=>t(this.get(e))))}}),r=Object.freeze({"copper-ore":{refineTo:"copper-bars",copper:!0,metal:!0,ore:!0},"copper-bars":{printTo:"copper-parts",copper:!0,metal:!0,refined:!0},"copper-parts":{copper:!0,metal:!0,printed:!0},"iron-ore":{refineTo:"iron-bars"},"iron-bars":{printTo:"iron-beams"},"iron-beams":{metal:!0,printed:!0},"uranium-ore":{refineTo:"enriched-uranium"},"enriched-uranium":{},quartz:{refinedTo:"glass"},glass:{printTo:"windows"},windows:{},"aluminum-ore":{refineTo:"aluminum-bars"},"aluminum-bars":{printTo:"aluminum-plates"},"aluminum-plates":{metal:!0,printed:!0},"titanium-ore":{refineTo:"titanium-bars"},"titanium-bars":{printTo:"titanium-parts"},"titanium-parts":{metal:!0,printed:!0},"obsidian-ore":{refineTo:"obsidian-shards"},"obsidian-shards":{printTo:"obsidian-parts"},"obsidian-parts":{printed:!0}});let c=0;function a(){return Number(new Date)+"-"+c+++"-"+Math.round(99999999*Math.random())}function l(t,e,o=0,i=0){return Math.sqrt(Math.pow(t-o,2)+Math.pow(e-i,2))}function d(t){let e,o,i=t.length;for(;0!==i;)o=Math.floor(Math.random()*i),i-=1,e=t[i],t[i]=t[o],t[o]=e;return t}let h=0;class p{constructor(t,e=0,o=0,i=4){this.parentBlock=t,this.id="c-"+h+++"-"+t.id,this.relativePos={x:e,y:o},this.pos={x:t.pos.x+e,y:t.pos.y+o},this.size=i,this.connection=null}setRelativePos(t,e){this.relativePos.x=t,this.relativePos.y=e,this.pos.x=this.parentBlock.pos.x+t,this.pos.y=this.parentBlock.pos.y+e}}class u{constructor(t="hull",r=0,c=0){this.type=t,this.typeObject=s.get(t),this.pos={x:r,y:c},this.size={x:this.typeObject.squareSize,y:this.typeObject.squareSize},this.id="vb-"+a(),this.cost=this.typeObject.cost,this.costLeft=((t,s)=>{for(var r in s||(s={}))e.call(s,r)&&n(t,r,s[r]);if(o)for(var r of o(s))i.call(s,r)&&n(t,r,s[r]);return t})({},this.cost),this.cargo={},this.power=0,this.rotation=0,this.on=!1,this.connections=this.typeObject.connections.map((t=>new p(this,t[0]*(this.size.x/2),t[1]*(this.size.y/2)))),this.updateConnectionPositions()}reId(){this.id="vb-"+a()}updateConnectionPositions(){this.connections.forEach((t=>{t.pos.x=this.pos.x+t.relativePos.x,t.pos.y=this.pos.y+t.relativePos.y}))}setPosition(t,e){this.pos.x=t,this.pos.y=e,this.updateConnectionPositions()}setRotation(t=0){this.rotate(-1*this.rotation),this.rotate(t)}rotate(t=90){this.rotation+=t,this.connections.forEach((e=>{const o=t*Math.PI/180,i=function(t=0,e=0,o=0,i=0,n=0){const s=Math.cos(-1*o),r=Math.sin(-1*o);return{x:t*s+e*r+i,y:-1*t*r+e*s+n}}(e.relativePos.x,e.relativePos.y,o);e.setRelativePos(i.x,i.y)}))}isOperational(){return!this.costLeft&&this.on}getNeighbors(){return this.connections.filter((t=>t.connection)).map((t=>t.connection.parentBlock))}getBlockCenter(){return{x:this.pos.x-this.size.x/2,y:this.pos.y-this.size.y/2}}getFreeConnections(){return this.connections.filter((t=>!t.block))}getCargoKeys(){return Object.keys(this.cargo).filter((t=>this.cargo[t]>0))}getCargoSpaceUsed(){return this.getCargoKeys().reduce(((t,e)=>t+this.cargo[e]),0)}getFreeSpace(){return this.typeObject.cargoSpace-this.getCargoSpaceUsed()}hasCapability(t){return this.typeObject[t]>0}construct(t,e=1){if(!this.costLeft[t])return!1;this.costLeft[t]-=e;Object.keys(this.costLeft).reduce(((t,e)=>t+this.costLeft[e]),0)<=0&&(this.costLeft=0)}addCargo(t,e=1){let o=e;for(;o>0;){if(this.getFreeSpace()<=0)return o;this.cargo[t.key]=(this.cargo[t.key]||0)+1,o-=1}return o}removeCargoByItemKey(t){return this.cargo[t]?(this.cargo[t]-=1,{key:t}):null}emptyCargo(){for(let t in this.cargo)delete this.cargo[t]}removeCargoByProperty(t){const e=this.getCargoKeys().filter((e=>r[e]&&r[e][t]));return e.length<=0?null:(d(e),this.removeCargoByItemKey(e[0]))}pullFromNeighborsByProperty(t,e=1/0){const o=[];return this.getNeighbors().forEach((i=>{if(o.length>=e)return o;const n=i.removeCargoByProperty(t);n&&(this.addCargo(n),o.push(n))})),o}refine(t){if(!this.hasCapability("refining")||this.getCargoSpaceUsed()<=0||!this.isOperational())return;const e=this.removeCargoByProperty("refineTo");if(!e)return;this.usePower(1);const o={key:r[e.key].refineTo};this.addCargo(o)}print(t){if(!this.hasCapability("printing")||this.getCargoSpaceUsed()<=0||!this.isOperational())return;const e=this.removeCargoByProperty("printTo");if(!e)return;this.usePower(1);const o={key:r[e.key].printTo};this.addCargo(o)}usePower(t){this.power=Math.max(0,this.power-t)}generatePower(t){this.costLeft&&(this.power=Math.min(this.typeObject.powerCapacity,this.power+this.typeObject.powering))}}class g{constructor(){this.elements={},this.showConnections=!0,this.highlightConnectionIds=[],this.zoom=1}static convertSnakeCaseToPlainText(t){return t.split("-").join(" ")}static getBlockInfoHtml(t){const e=t.typeObject,o=["type","category","squareSize","cost","connections","powerCapacity","cargoSpace"],i=Object.keys(e).filter((t=>!o.includes(t)&&0!==e[t])),n=t.costLeft?`<div>\n\t\t\t\t<dt>Build Requirements:</dt>\n\t\t\t\t${Object.keys(t.costLeft).map((e=>`<dd>${t.costLeft[e]} ${e}</dd>`)).join("")}\n\t\t\t</div>`:"",s=e.cargoSpace<=0?"":`<div>\n\t\t\t\t<dt>Cargo: (max ${e.cargoSpace})</dt>\n\t\t\t\t<div class="cargo-list">\n\t\t\t\t\t${t.getCargoKeys().map((e=>`<dd>${t.cargo[e]} ${e}</dd>`)).join("")}\n\t\t\t\t</div>\n\t\t\t</div>`;return`<dl>\n\t\t\t\t${n}\n\t\t\t\t<div><dt>Power:</dt><dd>${t.power} / ${e.powerCapacity}</dd><dd>${t.on?"ON":"OFF"}</dd></div>\n\t\t\t\t${i.map((t=>`<div><dt>${t}</dt><dd>${e[t]}</dd></div>`)).join("")}\n\t\t\t\t${s}\n\t\t\t</dl>`}static setElementSizeAndPosition(t,e,o,i,n,s=this.zoom){const{style:r}=t;r.width=`${e}vmin`,r.height=`${o}vmin`,r.top=`${i}vmin`,r.left=`${n}vmin`}addElement(t,e,o="",i="div",n=""){if(this.elements[t])return this.elements[t];const s=document.querySelector(`#${t}`);if(s)return s;const r=document.createElement(i);return r.id=t,o&&r.classList.add(o),n&&(r.innerHTML=n),e.appendChild(r),this.elements[t]=r,r}renderConnection(t,e,o,i){const n=this.addElement(t.id,e,"connection"),s=n.style;let r,c;o?(r=i.y/2+(t.relativePos.y-t.size/2),c=i.x/2+(t.relativePos.x-t.size/2)):(r=t.pos.y-t.size/2,c=t.pos.x-t.size/2),g.setElementSizeAndPosition(n,t.size,t.size,r,c),s.display=this.showConnections&&!t.connection?"block":"none";const a=this.highlightConnectionIds.includes(t.id);n.classList.toggle("highlight",a)}renderBlockInfo(t,e){const o=`<div class="block-info-title">${g.convertSnakeCaseToPlainText(t.type)}</div>`,i=this.addElement(`info-${t.id}`,this.elements.blockInfoWindows,"block-info","aside",o),n=this.addElement(`info-${t.id}-content`,i),s=`<button type="button" class="demolish" data-blockid="${t.id}">Demolish</button>\n\t\t\t<button type="button" class="power-switch">On/Off</button>\n\t\t\t<button type="button" class="empty">Empty</button>\n\t\t\t<button type="button" class="close">Close</button>`;this.addElement(`info-${t.id}-ui`,i,"block-info-ui","div",s),i.classList.add(`b-${t.type}`),i.classList.toggle("show",e),i.dataset.blockid=t.id,e&&(n.innerHTML=g.getBlockInfoHtml(t))}renderBlock(t,e,o){const i=this.addElement(t.id,e,"block");i.tabIndex=0;const n=t.getBlockCenter();g.setElementSizeAndPosition(i,t.size.x,t.size.y,n.y,n.x),i.classList.add(`b-${t.type}`),i.classList.toggle("construction",Boolean(t.costLeft)),i.classList.toggle("off",!t.on),i.style.transform=`rotate(${t.rotation}deg)`;const s=i.classList.contains("show-info");this.renderBlockInfo(t,s),t.connections.forEach((e=>{const n=!o;this.renderConnection(e,o||i,n,t.size)}))}renderPilot(t){const e=this.addElement("pilot",t,"pilot");g.setElementSizeAndPosition(e,8,8,-16,-4)}renderVehicle(t){const e=this.addElement(t.id,this.elements.vehicles,"vehicle"),{style:o}=e;o.transform=`rotate(${t.rotation}deg)`,this.renderPilot(e);const i=[];t.blockSet.forEach((t=>{this.renderBlock(t,e,this.elements.connections),i.push(t.id)})),this.elements.connections.style.transform=`rotate(${t.rotation}deg)`;const n=e.querySelectorAll(".block");for(let s=0;s<n.length;s++)i.includes(n[s].id)||(delete this.elements[n[s].id],n[s].remove())}renderHand(t){t?this.renderBlock(t,this.elements.hand):this.elements.hand.innerHTML=""}renderHole(t,e,o){const i=this.addElement(t.id,this.elements.holes,"hole"),n=t.size/2;g.setElementSizeAndPosition(i,t.size,t.size,t.pos.y+o,o-n);i.style.transform=`rotate(${t.rotation}deg)`}renderPlanet(t,e){const o=this.elements.planet,i=o.style,{diameter:n}=t,s=n/2,r=-1*s-e.x,c=-1*s-e.y;g.setElementSizeAndPosition(o,n,n,c,r),i.top=`calc(50vh + ${c}vmin)`,i.left=`calc(50vw + ${r}vmin)`;const a=[];t.holes.forEach((t=>{this.renderHole(t,e,s),a.push(t.id)}));const l=this.elements.holes.children;for(let d=0;d<l.length;d++){if(a.includes(l[d].id))return;delete this.elements[l[d].id],l[d].remove()}}renderBuildUI(){s.forEach((t=>{const e=this.addElement(t.type,this.elements.buildBlockList,"","li"),o=this.addElement(t.type+"button",e,"","button");o.type="button",o.classList.add("build-block"),o.classList.add(`b-${t.type}`),o.innerText=g.convertSnakeCaseToPlainText(t.type),o.dataset.type=t.type}))}render({vehicles:t,blockInHand:e,connections:o,planet:i,focusPosition:n,distToCore:s}){this.showConnections=Boolean(e),this.highlightConnectionIds=o.map((t=>null==t?void 0:t.id)),t.forEach((t=>this.renderVehicle(t))),this.renderBuildUI(),this.renderHand(e),this.renderPlanet(i,n);const r=i.getLevelData(s).level,c=i.radius-s;this.elements.depthNumber.innerText=Math.round(Math.max(0,c)).toLocaleString()+` Level: ${r}`}init(){this.elements.vehicles=document.querySelector(".vehicles"),this.elements.connections=document.querySelector(".connections"),this.elements.planet=document.querySelector(".planet"),this.elements.hand=document.querySelector(".hand"),this.elements.buildBlockList=document.querySelector(".build-block-list"),this.elements.holes=document.querySelector(".holes"),this.elements.depthNumber=document.querySelector(".depth-number"),this.elements.blockInfoWindows=document.querySelector(".block-info-windows")}}class m{constructor(t=1){this.radius=2500*t,this.diameter=2*this.radius,this.holes=[]}getLevelData(t){return t>this.radius?{level:0,hardness:0}:t>.7*this.radius?{level:1,hardness:Math.pow(2,3),dropItemKey:"copper-ore"}:t>.5*this.radius?{level:2,hardness:Math.pow(3,3),dropItemKey:"iron-ore"}:t>.25*this.radius?{level:3,hardness:Math.pow(4,3),dropItemKey:"aluminum-ore"}:t>.1*this.radius?{level:4,hardness:Math.pow(5,3),dropItemKey:"titanium-ore"}:{level:5,hardness:Math.pow(6,3),dropItemKey:"obsidian-ore"}}}console.log("game");const y={x:0,y:0},f=new class{constructor(){this.MAX_ZOOM_DELTA=600,this.MIN_ZOOM=.1,this.MAX_ZOOM=5e3,this.ZOOM_MULTIPLIER=.001,this.zoom=1}setup(){window.addEventListener("wheel",(t=>{const e=Math.min(this.MAX_ZOOM_DELTA,Math.abs(t.deltaY))*this.ZOOM_MULTIPLIER*this.zoom,o=t.deltaY<0?-1:1;this.zoom=Math.max(this.MIN_ZOOM,Math.min(this.MAX_ZOOM,this.zoom+o*e)),console.log("zoom",this.zoom)}))}},b=new g,v=new Set,w={},k=new class{constructor(){this.blockSet=new Set,this.id=`veh-${a()}`,this.pos={x:0,y:0},this.rotation=0}getBlocks(){return this.blockSet.values()}getBlocksArray(){return Array.from(this.blockSet)}getShuffledBlocksArray(){return d(this.getBlocksArray())}findBlockById(t){return this.getBlocksArray().find((e=>e.id===t))}reconnectAll(){this.blockSet.forEach((t=>t.connections.forEach((t=>{t.connection=null,this.blockSet.forEach((e=>e.connections.forEach((e=>{e!==t&&e.pos.x===t.pos.x&&e.pos.y===t.pos.y&&(t.connection=e,e.connection=t)}))))}))))}addBlock(t,e,o,[i=null,n=null]=[]){if(i&&n){const t=n.pos;e=t.x-i.relativePos.x,o=t.y-i.relativePos.y,console.log("Add block based on connections",i,n,"\n",e,o)}const s=new u(t,e,o);return console.log("Adding block",s),this.blockSet.add(s),this.reconnectAll(),s}magicBuild(){this.blockSet.forEach((t=>t.costLeft=0))}getOperationalDrills(){return this.getBlocksArray().filter((t=>t.hasCapability("drilling")&&t.isOperational()))}getDrillCount(){return this.getOperationalDrills().length}getDrillPower(){return this.getOperationalDrills().reduce(((t,e)=>Math.pow(e.typeObject.drilling,2)+t),0)}getDrillMaxTier(){return this.getOperationalDrills().reduce(((t,e)=>Math.max(t,e.typeObject.drilling)),0)}getDrillSize(){return 12+4*this.getDrillCount()}removeCargoByItemKey(t){const e=this.getShuffledBlocksArray();for(let o=0;o<e.length;o++){const i=e[o].removeCargoByItemKey(t);if(i)return i}return null}construct(t){const e=this.getShuffledBlocksArray().filter((t=>t.costLeft));if(e.length<=0)return;const o=Object.keys(e[0].costLeft).filter((t=>e[0].costLeft[t]>0)),i=(n=o)[Math.floor(Math.random()*n.length)];var n;this.removeCargoByItemKey(i)&&e[0].construct(i,1)}demolish(t){const e=this.findBlockById(t);return!!e&&(this.blockSet.delete(e),this.reconnectAll(),!0)}collectOre(t){const e=this.getShuffledBlocksArray().filter((t=>t.hasCapability("drilling")&&t.getFreeSpace()>0&&t.isOperational()));if(e.length<=0)return;d(t);t.forEach((t=>{const o=e[0];0===o.addCargo(t)&&(t.collectedBy=o.id)}))}collect(t,e=[]){this.collectOre(e)}print(t){this.blockSet.forEach((e=>e.print(t)))}refine(t){this.blockSet.forEach((e=>e.refine(t)))}supportLife(t){}convey(t){const e=this.getShuffledBlocksArray(),o=t=>e.filter((e=>e.hasCapability(t)&&e.hasCapability("pulling")&&e.getFreeSpace()>0&&e.isOperational()));o("refining").forEach((t=>t.pullFromNeighborsByProperty("refineTo",t.typeObject.pulling)));o("printing").forEach((t=>t.pullFromNeighborsByProperty("printTo",t.typeObject.pulling)));o("pulling").forEach((t=>t.pullFromNeighborsByProperty("printed",t.typeObject.pulling)))}generatePower(t){this.blockSet.forEach((e=>e.generatePower(t)))}run(t,e){this.construct(t),this.collect(t,e),this.print(t),this.refine(t),this.supportLife(t),this.convey(t),this.generatePower(t)}};let S=1,L=new m;v.add(k),k.pos.y=-1*L.radius-14,k.addBlock("mini-dome",0,-13),k.addBlock("survival-core",0,0),k.addBlock("aluminum-cargo-drill",0,12),k.magicBuild();let O=!0,E=null,B=[],C=!0,M=0,P=0;function x(){if(!E)return[];let t=200,e=[null,null];return E.connections.forEach((o=>{const i=document.getElementById(o.id);if(!i)return;const n=i.getBoundingClientRect();v.forEach((i=>i.blockSet.forEach((i=>i.connections.forEach((i=>{if(i.connection)return;const s=document.getElementById(i.id);if(!s)return;const r=s.getBoundingClientRect(),c=l(n.left,n.top,r.left,r.top);c<t&&(t=c,e[0]=o,e[1]=i)}))))))})),e}function z(t){return Math.random()*function(t){const e=k.getDrillPower(),o=0===t?2*e:e/t;return M%10==0&&console.log("power",e,"hardness",t,"speed",o),o}(t.hardness)}function I(t){if(!C)return;E&&E.setPosition(B[0]/window.innerWidth*100,B[1]/window.innerHeight*100);const e=x(),o=l(0,0,k.pos.x,k.pos.y);y.y+=.05,b.render({vehicles:v,blockInHand:E,connections:e,planet:L,distToCore:o,focusPosition:y}),Math.random()<.02&&k.getDrillCount()&&(L.holes.push({id:`hole-${a()}`,size:k.getDrillSize(),rotation:Math.round(360*Math.random()),pos:{x:k.pos.x,y:k.pos.y}}),L.holes.length>200&&L.holes.shift(),k.rotation+=3*Math.random()-3*Math.random()),window.requestAnimationFrame(I)}function $(){if(!C)return;M++;const t=l(0,0,k.pos.x,k.pos.y),e=L.getLevelData(t);y.x=k.pos.x,y.y=k.pos.y,k.pos.y+=z(e),k.pos.y<2&&k.pos.y>-2&&function(t){if(w[t])return!0;w[t]=!0,alert(`You achieved '${t}'!`)}("reached the core"),t>L.radius&&Boolean(w["reached the core"])&&(D(),confirm("Fly to a new planet?")?(w["reached the core"]=!1,S+=1,L=new m(S),k.pos.y=-1*L.radius-14,q()):q());const o=function(t,e,o){if(!t.dropItemKey)return[];if(Math.random()>.05)return;let i=t;if(Math.random()<.3){const t=o+(e-o)*Math.random();i=L.getLevelData(t)}return[{key:i.dropItemKey}]}(e,L.radius,t);k.run(100,o),P=window.setTimeout($,100)}function T(t){const e=t.type.startsWith("touch")?t.targetTouches[0]:t;return[e.pageX,e.pageY]}function j(){document.querySelector(".build-category-list").classList.toggle("open")}function A(t){O&&(O=!1,document.querySelectorAll(".intro").forEach((t=>t.classList.add("dismiss")))),E&&3!==t.which&&(console.log("mouse up",t.target),function(){const t=x();if(t.length<2||!t[0]||!t[1])return void(E=null);k.addBlock(E.type,0,0,x()).setRotation(E.rotation),E=null}())}function q(){C=!0,I(),$()}function D(){C=!1,window.clearTimeout(P)}document.addEventListener("DOMContentLoaded",(async()=>{b.init(),document.querySelector(".build-ui").addEventListener("click",(t=>{console.log(t.target.classList);const{classList:e}=t.target;e.contains("toggle-build-menu")?j():e.contains("build-block")&&(E=new u(t.target.dataset.type),E.costLeft=0,j())})),document.querySelector(".vehicles").addEventListener("click",(t=>{const{classList:e}=t.target;e.contains("block")&&t.target.classList.toggle("show-info")})),document.querySelector(".block-info-windows").addEventListener("click",(t=>{const{classList:e}=t.target,o=t.target.closest(".block-info"),i=null==o?void 0:o.dataset.blockid,n=e.contains("demolish");if((e.contains("close")||n)&&(o.classList.remove("show"),document.getElementById(i).classList.remove("show-info")),n)k.demolish(i);else if(e.contains("power-switch")){const t=k.findBlockById(i);t&&(t.on=!t.on)}else if(e.contains("empty")){const t=k.findBlockById(i);t&&t.emptyCargo()}})),document.addEventListener("mousemove",(t=>B=T(t))),document.addEventListener("touchmove",(t=>B=T(t))),window.oncontextmenu=t=>{console.log("context menu",t),E&&(E=null,t.preventDefault())},document.addEventListener("mouseup",A),document.addEventListener("touchend",A),window.addEventListener("keypress",(t=>{switch(t.key.toUpperCase()){case"R":E&&E.rotate(90)}console.log(t.key)})),f.setup(),q()})),window.g={renderer:b,startLoops:q,stopLoops:D,drill:k,planet:L};
